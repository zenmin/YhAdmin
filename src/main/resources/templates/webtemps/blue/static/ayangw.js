$(function(){$(".btnSpan").click(function(){var a=$(this).attr("title");$(":radio").val([a])});$("#xxx").click(function(){var o=$("#kc").attr("alt");if(o<=0){layer.msg("该商品库存不足，无法购买！");return}var g=$("#gid").val();var j=$("#gid option:selected").attr("id");var h=$("#need").val();var c=$("#gid option:selected").attr("title");var f=$("#lx").val();var l=$("input:radio[name='type']:checked").val();var n=$("input:radio[name='type']:checked").attr("title");var i=d();var e=parseInt($("#number").val());var m=checkLx(f);if(o<e){layer.msg("选择数量大于库存数量！");return}if(e<=0){layer.msg("选择数量请大于0件！");return}if(m==false){layer.msg("请输入正确的联系方式");return}if(l==null||l==""){layer.msg("请选择您的付款方式");return}if(j==""||h==""||j==null||h==null){layer.msg("当前商品无法创建订单！");return}var q=layer.load(2,{shade:[0.1,"#fff"]});$.ajax({type:"POST",url:"ajax.php?act=selKm",data:{"gid":j},dataType:"json",success:function(a){if(a.code==-1){layer.close(q);layer.msg("该商品卡密库存不足！无法购买！");return}},error:function(a){layer.close(q);layer.msg("服务器错误");return}});layer.close(q);c=c*e;var p="type="+l+"&name="+g+"&money="+c+"&number="+e+"&out_trade_no="+i+"&gid="+j;var k="请核对订单信息！<br>订单编号："+i+"<br>商品名称："+g+"<br>购买数量："+e+"<br>商品价格："+c+"￥"+"<br>联系方式："+f+"<br>付款方式："+n;layer.confirm(k,{btn:["立即付款","取消付款"]},function(){var a=layer.load(2,{shade:[0.1,"#fff"]});$.ajax({type:"POST",url:"ajax.php?act=create",data:{"out_trade_no":i,"gid":j,"money":c,"rel":f,"type":l,"number":e},dataType:"json",success:function(b){layer.close(a);if(b.code!=0){layer.alert("创建订单失败！"+b.msg);return false}window.location.href="other/submit.php?"+p},error:function(b){layer.close(a);layer.msg("服务器错误");return false}})})});$("#submit_query").click(function(){var a=$("#tqm").val();if(a==null||a==""){layer.msg("请输入提取卡密的凭证！");return false}var b=layer.load(2,{shade:[0.1,"#fff"]});$.ajax({type:"POST",url:"ajax.php?act=tqKm",data:{"t":a},dataType:"json",success:function(c){layer.close(b);if(c.code==0){$("#list").empty();$("#list").append(c.msg);$("#result2").slideDown()}else{layer.msg(c.msg)}},error:function(c){layer.close(b);layer.msg("服务器错误");return false}})});$("#copykm").click(function(){copyToClipboard("km");layer.alert("成功复制卡密到剪切板!")});$("#subimt_email").click(function(){var h=$("#txt_email").val();var c=/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;isok=c.test(h);if(!isok){alert("邮箱格式不正确，请重新输入！");return false}var f=$("#td1").text();var g=$("#td2").text();var b=$("#td3").text();var i=$("#td4").text();var a=layer.load(2,{shade:[0.1,"#fff"]});$.ajax({type:"POST",url:"ajax.php?act=email",data:{"od_n":f,"od_b":g,"od_d":b,"od_k":i,"e":h},dataType:"json",success:function(e){layer.close(a);layer.msg(e.msg)},error:function(e){layer.close(a);layer.msg("发送失败！")}})})});function getPoint(b){var c=$(b).val();var a=layer.open({type:2,content:"加载中..."});$.ajax({type:"POST",url:"/goods/getByCondition",data:{"cid":c},dataType:"json",success:function(h){layer.close(a);list=h.data;var g="";if(list.length>0){for(var f=0;f<list.length;f++){var e=list[f];g=g+"<option id='"+e.id+"' pullDiv='"+e.needPwd+"' kc='"+e.kmCount+"' title='"+e.price+"' alt='"+e.goodsDesc+"' value='"+e.id+"' "+(g==""?"selected":"")+">"+e.name+"</option>"}}else{g=g+"<option value='-1' pullDiv='false' kc='0' title='0' alt='' disabled='disabled' selected>该分类下没有商品</option>"}$("#gid").html(g);getPrice()},error:function(e){layer.close(a);layer.msg("服务器错误"+e)}})}function getInfo(){var a=$("#gid option:selected").attr("alt");if(a==""||a==null){$("#ginfo").text("该商品无介绍")}else{$("#ginfo").text(a)}}function getPrice(){var a=$("#gid option:selected").attr("title");$("#need").text("￥"+a);getInfo();getPrice_zongzi()}function getPrice_zongzi(){var b=$("#gid option:selected").attr("title");$("#need").text("￥"+b);checknum_zongzi();var a=$("#gid option:selected").attr("kc");$("#kc").text(a);$("#kc").attr("alt",a);var c=$("#gid option:selected").attr("pullDiv");if(c=="true"){$("#pullDiv").show()}else{$("#pullDiv").hide()}}function getImgs(){var a=$("#gid option:selected").attr("imgs");if(a==""||a==null||a=="undefined"){a="./assets/goodsimg/df.jpg"}$("#goodimgs").attr("src",a)}function getSpan(f,h,g,a){var f=f;var h=h;var g=g;var a=a;var e=document.getElementsByTagName("span");for(var c=0;c<e.length;c++){var b=$(e[c]).attr("title");if(b=="alipay"&&f==1){$(e[c]).hide()}if(b=="qqpay"&&h==1){$(e[c]).hide()}if(b=="tenpay"&&g==1){$(e[c]).hide()}if(b=="tenpay"&&g==0){$(e[c]).show()}if(b=="wxpay"&&a==1){$(e[c]).hide()}}}function d(){var b=new Date();var a;a=b.getFullYear()+""+b.getMonth()+""+b.getDate()+""+b.getHours()+""+b.getMinutes()+""+b.getMilliseconds()+""+randomNum(100,999);return a}function checkLx(a){var b=a;if(!isNaN(b)&&b!=""){return true}else{return false}}function randomNum(b,a){switch(arguments.length){case 1:return parseInt(Math.random()*b+1);break;case 2:return parseInt(Math.random()*(a-b+1)+b);break;default:return 0;break}}function copyToClipboard(b){var a=document.createElement("input");var c=document.getElementById(b).innerHTML||document.getElementById(b).value;
    a.setAttribute("value",c);document.body.appendChild(a);a.select();document.execCommand("copy");document.body.removeChild(a)}function Addme(){url=document.URL;title=$("#bttt").text();window.external.AddFavorite(url,title)}function numstepUp(){var a=parseInt($("#number").val());$("#number").val(a+1)}function numstepDown(){var a=parseInt($("#number").val());if(a>1){$("#number").val(a-1)}}function checknum(){var b=$("#kc").attr("alt");var c=parseInt($("#number").val());if(c<=0||c==null||c==""||isNaN(c)){$("#number").val(1)}else{$("#number").val(c)}if(b<c){$("#number").val(b)}}function checknum_zongzi(){var b=$("#kc").attr("alt");var c=parseInt($("#number").val());if(c<=0||c==null||c==""||isNaN(c)){$("#number").val(1)}else{$("#number").val(c)}if(b<c){$("#number").val(b)}var f=parseInt($("#number").val());var e=$("#gid option:selected").attr("title");$("#allprice").text(f*e)}function zongzisub(){var o=$("#kc").attr("alt");if(o<=0){layer.msg("该商品库存不足，无法购买！");return}var g=$("#gid").val();var j=$("#gid option:selected").attr("id");var h=$("#need").val();var c=$("#gid option:selected").attr("title");var f=$("#lx").val();var l=$("input:radio[name='type']:checked").val();var n=$("input:radio[name='type']:checked").attr("title");var i=d();var e=parseInt($("#number").val());var m=checkLx(f);if(o<e){layer.msg("选择数量大于库存数量！",{time:3000,icon:6});return}if(e<=0){layer.msg("选择数量请大于0件！",{time:3000,icon:6});return}if(f.length<5||m==false||f==" "){layer.msg("请输入正确的联系方式",{time:3000,icon:6});return}if(l==null||l==""){layer.msg("请选择您的付款方式",{time:3000,icon:6});return}if(j==""||c==""||j==null||c==null){layer.msg("当前商品无法创建订单！",{time:3000,icon:6});return}var q=layer.load(2,{shade:[0.1,"#fff"]});$.ajax({type:"POST",url:"ajax.php?act=selKm",data:{"gid":j},dataType:"json",success:function(a){if(a.code==-1){layer.close(q);layer.msg("该商品卡密库存不足！无法购买！");return}},error:function(a){layer.close(q);layer.msg("服务器错误");return}});layer.close(q);c=c*e;var p="type="+l+"&name="+g+"&money="+c+"&number="+e+"&out_trade_no="+i+"&gid="+j;var k="请核对订单信息！<br>订单编号："+i+"<br>商品名称："+g+"<br>购买数量："+e+"<br>商品价格："+c+"￥"+"<br>联系方式："+f+"<br>付款方式："+n;layer.confirm(k,{btn:["立即付款","取消付款"]},function(){var a=layer.load(2,{shade:[0.1,"#fff"]});$.ajax({type:"POST",url:"ajax.php?act=create",data:{"out_trade_no":i,"gid":j,"money":c,"rel":f,"type":l,"number":e},dataType:"json",success:function(b){layer.close(a);if(b.code!=0){layer.open({content:b.msg,skin:"msg",time:2});return false}},error:function(b){layer.close(a);layer.msg("服务器错误");return false}})})};